# 网络切换功能说明

## 新增功能

已为 Web3 University 前端应用添加了完整的网络切换功能，用户可以在不同的以太坊网络之间轻松切换。

## 功能特性

### 1. 支持的网络

- **Sepolia 测试网** (Chain ID: 11155111)
  - 推荐用于测试
  - 颜色：紫色
  - 可从 faucet 获取测试 ETH

- **Hardhat 本地网络** (Chain ID: 31337)
  - 用于本地开发
  - 颜色：黄色
  - 快速、免费的交易

- **Ethereum 主网** (Chain ID: 1)
  - 生产环境使用
  - 颜色：蓝色
  - 需要真实的 ETH

### 2. NetworkSwitcher 组件

位于导航栏右侧，Connect Wallet 按钮旁边。

**功能：**
- 显示当前连接的网络
- 网络状态指示器（不同颜色）
- 下拉菜单显示所有可用网络
- 一键切换网络
- 加载状态显示
- 不支持网络警告

**交互：**
- 点击当前网络按钮打开下拉菜单
- 选择目标网络自动切换
- 切换成功后菜单自动关闭
- 点击外部区域关闭菜单

### 3. NetworkWarning 组件

当用户连接到不支持的网络时，页面顶部会显示警告横幅。

**功能：**
- 红色渐变警告背景
- 清晰的错误说明
- "切换到 Sepolia" 快捷按钮
- 可关闭的横幅
- 动画效果

## 文件结构

```
frontend/src/
├── components/
│   ├── NetworkSwitcher.jsx    # 网络切换组件
│   ├── NetworkWarning.jsx     # 网络警告横幅
│   └── Layout.jsx             # 已更新：集成网络组件
└── config/
    └── wagmi.js               # 已更新：多网络配置
```

## 代码示例

### 使用 NetworkSwitcher

```jsx
import NetworkSwitcher from './components/NetworkSwitcher';

function Navigation() {
  return (
    <nav>
      <NetworkSwitcher />
      <ConnectButton />
    </nav>
  );
}
```

### 使用 NetworkWarning

```jsx
import NetworkWarning from './components/NetworkWarning';

function App() {
  return (
    <div>
      <NetworkWarning />
      {/* 其他内容 */}
    </div>
  );
}
```

## 网络颜色方案

| 网络 | Chain ID | 颜色 | 用途 |
|------|----------|------|------|
| Ethereum Mainnet | 1 | 蓝色 | 生产环境 |
| Sepolia | 11155111 | 紫色 | 测试环境 |
| Hardhat | 31337 | 黄色 | 本地开发 |
| 不支持的网络 | - | 红色 | 错误提示 |

## UI/UX 特性

### 1. 视觉反馈
- ✅ 当前网络高亮显示
- ✅ 绿色脉动指示器
- ✅ 切换时的加载动画
- ✅ 悬停效果
- ✅ 平滑的过渡动画

### 2. 用户体验
- ✅ 直观的下拉菜单
- ✅ 清晰的网络信息（名称 + Chain ID）
- ✅ 一键快速切换
- ✅ 错误状态明显提示
- ✅ 自动关闭菜单

### 3. 响应式设计
- ✅ 移动端适配
- ✅ 触摸友好
- ✅ 合理的间距

## 使用场景

### 场景 1：切换到测试网
1. 点击当前网络按钮
2. 选择 "Sepolia"
3. MetaMask 弹出确认
4. 确认后自动切换
5. 页面刷新显示新网络

### 场景 2：本地开发
1. 启动 Hardhat 节点
2. 连接 MetaMask 到 localhost:8545
3. 网络切换器显示 "Hardhat"
4. 开始开发和测试

### 场景 3：错误网络警告
1. 用户连接到 BSC 或其他网络
2. 顶部显示红色警告横幅
3. 点击"切换到 Sepolia"快速修复
4. 或手动使用网络切换器

## 技术实现

### Wagmi Hooks

```jsx
import { useNetwork, useSwitchNetwork } from 'wagmi';

// 获取当前网络
const { chain } = useNetwork();

// 切换网络
const { switchNetwork, isLoading } = useSwitchNetwork();

// 执行切换
switchNetwork(11155111); // Sepolia
```

### 网络检测

```jsx
// 检查是否为不支持的网络
if (chain?.unsupported) {
  // 显示警告
}

// 检查是否为特定网络
if (chain?.id === 11155111) {
  // Sepolia 网络
}
```

## 配置说明

### Wagmi 配置

在 `src/config/wagmi.js` 中配置支持的网络：

```javascript
import { mainnet, sepolia, hardhat } from 'wagmi/chains';

export const supportedChains = [
  sepolia,    // 测试网
  hardhat,    // 本地开发
  mainnet,    // 主网
];
```

### 添加更多网络

如需添加其他网络（如 Polygon、Arbitrum），更新配置：

```javascript
import { polygon, arbitrum } from 'wagmi/chains';

export const supportedChains = [
  sepolia,
  hardhat,
  mainnet,
  polygon,
  arbitrum,
];
```

## 样式定制

### 修改颜色

在 `NetworkSwitcher.jsx` 中的 `getNetworkColor` 函数：

```javascript
const getNetworkColor = (chainId) => {
  switch (chainId) {
    case 1:
      return 'text-blue-400 bg-blue-500/10 border-blue-500/20';
    case 11155111:
      return 'text-purple-400 bg-purple-500/10 border-purple-500/20';
    // 添加更多网络颜色
    default:
      return 'text-gray-400 bg-gray-500/10 border-gray-500/20';
  }
};
```

## 常见问题

**Q: 为什么切换网络失败？**
A: 请确保 MetaMask 已安装并解锁，然后在弹出窗口中确认切换请求。

**Q: 如何添加本地网络到 MetaMask？**
A: 打开 MetaMask → 设置 → 网络 → 添加网络，填入：
- 网络名称: Hardhat
- RPC URL: http://localhost:8545
- Chain ID: 31337
- 货币符号: ETH

**Q: 网络切换器不显示？**
A: 网络切换器仅在钱包已连接时显示。请先连接 MetaMask。

**Q: 警告横幅无法关闭？**
A: 点击右侧的 X 按钮可以临时关闭。切换到支持的网络后会自动消失。

**Q: 如何禁用主网？**
A: 在开发阶段，可以从 `wagmi.js` 的 `supportedChains` 数组中移除 `mainnet`。

## 最佳实践

1. **开发阶段**
   - 使用 Hardhat 本地网络进行快速迭代
   - 定期在 Sepolia 测试网测试

2. **测试阶段**
   - 主要使用 Sepolia 测试网
   - 测试网络切换功能
   - 验证不支持网络的警告

3. **生产部署**
   - 确保合约已部署到主网
   - 更新环境变量中的合约地址
   - 考虑是否禁用某些网络

4. **用户引导**
   - 在首页添加网络切换说明
   - 提供 MetaMask 配置教程
   - 在错误时给出明确指引

## 性能优化

- ✅ 使用 Wagmi 的缓存机制
- ✅ 组件懒加载
- ✅ 最小化重渲染
- ✅ 事件监听器清理

## 安全考虑

- ✅ 只允许预定义的网络
- ✅ 不自动切换网络（需用户确认）
- ✅ 清晰显示当前网络
- ✅ 警告不支持的网络

## 未来改进

- [ ] 添加更多网络（Layer 2）
- [ ] 网络性能指示器
- [ ] Gas 价格显示
- [ ] 自定义网络添加
- [ ] 网络切换历史记录

## 更新日志

### v1.1.0 - 2024-01-25
- ✅ 添加网络切换组件
- ✅ 支持 Sepolia、Hardhat、Mainnet
- ✅ 添加网络警告横幅
- ✅ 更新导航栏布局
- ✅ 添加网络颜色标识

## 相关文档

- [Wagmi 文档 - Network Switching](https://wagmi.sh/react/hooks/useSwitchNetwork)
- [RainbowKit 文档](https://www.rainbowkit.com/docs)
- [MetaMask 网络配置](https://metamask.zendesk.com/hc/en-us/articles/360043227612)

---

如有问题或建议，请查看主 README 文档或提交 Issue。
